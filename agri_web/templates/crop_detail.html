{% extends "base.html" %}
{% block title %}{{ crop.title }}{% endblock %}

{% block content %}
<div class="container py-5" style="max-width: 1100px;">
    <h1 class="text-center mb-4 text-success">{{ crop.title }}</h1>
    <div class="text-center mb-5">
        <img src="{{ crop.plant_image_url }}" alt="{{ crop.title }}" class="img-fluid rounded shadow" style="max-height: 500px;">
        <p class="mt-3 text-muted"><strong>Also known as:</strong> {{ crop.other_names }}</p>
    </div>

    <div class="accordion" id="cropAccordion">
        {% for section in crop.sections_order %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button {{ '' if loop.first else 'collapsed' }}" type="button" data-bs-toggle="collapse"
                        data-bs-target="#section{{ loop.index }}">
                    {{ section.replace('_', ' ')|title }}
                </button>
            </h2>
            <div id="section{{ loop.index }}" class="accordion-collapse collapse {{ 'show' if loop.first else '' }}" data-bs-parent="#cropAccordion">
                <div class="accordion-body">
                    {% if section == 'varieties' %}
                        <div class="table-responsive">
                            <table class="table table-striped table-success">
                                <thead><tr><th>Type</th><th>Name</th><th>Details</th></tr></thead>
                                <tbody>
                                    {% for v in crop.varieties %}
                                    <tr>
                                        <td><strong>{{ v.type }}</strong></td>
                                        <td>{{ v.name or v.examples or '—' }}</td>
                                        <td>
                                            {% if v.yield %}<strong>Yield:</strong> {{ v.yield }}<br>{% endif %}
                                            {% if v.features %}{{ v.features }}<br>{% endif %}
                                            {% if v.use %}<strong>Use:</strong> {{ v.use }}{% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif section in ['major_pests_diseases', 'processing_opportunities'] %}
                        <ul class="list-group list-group-flush">
                            {% for item in crop[section] %}
                            <li class="list-group-item">{{ item }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        {{ crop[section]|replace('•', '<br>•')|safe }}
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Companies -->
    <div class="mt-5">
        <h3 class="text-center mb-4 text-success">Useful Companies & Buyers</h3>
        {% for category, companies in agri_companies.items() %}
        <h5 class="mt-4 text-success">{{ category }}</h5>
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for comp in companies %}
            <div class="col">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <a href="{{ comp.url }}" target="_blank" class="text-decoration-none fw-bold">{{ comp.name }}</a>
                        <small class="text-muted d-block mt-1">{{ comp.note }}</small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <div class="text-center mt-5">
        <a href="{{ url_for('crops_page') }}" class="btn btn-success btn-lg">← Back to Crops</a>
    </div>
</div>
{% endblock %}